{% extends 'app_LyfeSync/layouts/masterpage_logado.html' %}
{% load static %}

{% block title %}
  Registrar Dicas (Admin)
{% endblock %}

{% block content_logado %}
  {# max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 bg-white rounded-xl shadow-2xl mt-8 #}
  <div class="container mt-5 mb-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-8 card p-4 p-md-5 rounded-4 shadow-lg border-0">
        <div class="mb-4">
          <button type="button" class="btn-adicionar-dica btn btn-sm btn-outline-success mb-2 d-flex align-items-center">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="btn-add-dica-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>Adicionar Dicas
          </button>
          {# text-3xl font-extrabold text-gray-800 mt-2 border-b pb-2 #}
          <h1 class="h3 fw-bolder text-dark border-bottom pb-2">Cadastro de Dicas de Autocuidado</h1>
        </div>

        {% if messages %}
          <div class="messages">
            {% for message in messages %}
              {# Substituindo classes de tags por alertas Bootstrap #}
              <div class="alert alert-{{ message.tags|default_if_none:'info' }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {# space-y-6 -> usando mb-4 e pt-4 #}
        <form method="post" action="{% url 'registrar_dica' %}">
          {% csrf_token %}

          <div class="mb-4">
            {# dica-label-text block text-xl mb-3 -> form-label #}
            <label class="form-label mb-3 dica-humor-label">Selecione o Humor:</label>
            {# dica-emoji-selector -> d-flex flex-wrap gap-2 #}
            <div class="dica-emoji-selector d-flex flex-wrap gap-2">
              {{ form.estado.as_hidden }}

              {% for value, label in form.fields.estado.choices %}
                {# dica-emoji-option (usar classe customizada e p-2 rounded) #}
                <div class="dica-emoji-option p-2 rounded text-center cursor-pointer" data-humor-value="{{ value }}" id="emoji-{{ value }}">
                  <span class="dica-emoji-icon emoji-{{ value|lower }}">
                    {% if value == 'Feliz' %}
                      ðŸ˜€
                    {% elif value == 'Calmo' %}
                      ðŸ˜Œ
                    {% elif value == 'Ansioso' %}
                      ðŸ˜Ÿ
                    {% elif value == 'Triste' %}
                      ðŸ˜¥
                    {% elif value == 'Irritado' %}
                      ðŸ˜¡
                    {% else %}
                      ?
                    {% endif %}
                  </span>
                  {# dica-emoji-text text-{{ value|lower }} -> small #}
                  <small class="dica-emoji-text text-{{ value|lower }} d-block">{{ label }}</small>
                </div>
              {% endfor %}
            </div>
            {# text-red-500 block mt-1 -> text-danger small d-block mt-1 #}
            {% if form.estado.errors %}
              <small class="text-danger d-block mt-1">{{ form.estado.errors }}</small>
            {% endif %}
          </div>

          <div class="mb-4">
            {# dica-label-text block -> form-label #}
            <label for="{{ form.nome_dica.id_for_label }}" class="form-label dica-label-text">Nome da Dica:</label>
            {# O widget de form do Django deve ser customizado com .form-control no `forms.py` ou adicionado via JS #}
            {{ form.nome_dica }}
            {% if form.nome_dica.errors %}
              <small class="text-danger d-block mt-1">{{ form.nome_dica.errors }}</small>
            {% endif %}
          </div>

          <div class="mb-4">
            {# dica-label-text block -> form-label #}
            <label for="{{ form.descricao.id_for_label }}" class="form-label dica-label-text">DescriÃ§Ã£o:</label>
            {# O widget de form do Django deve ser customizado com .form-control no `forms.py` ou adicionado via JS #}
            {{ form.descricao }}
            {% if form.descricao.errors %}
              <small class="text-danger d-block mt-1">{{ form.descricao.errors }}</small>
            {% endif %}
          </div>

          {# flex justify-end pt-4 -> d-flex justify-content-end pt-3 #}
          <div class="d-flex justify-content-end pt-3">
            {# btn-salvar-dica -> btn btn-primary (ou outra cor) #}
            <button type="submit" class="btn-salvar-dica btn btn-lg btn-success fw-bold">Salvar Dica</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const emojiOptions = document.querySelectorAll('.dica-emoji-option')
      const estadoInput = document.querySelector('input[name="estado"]')
      const defaultHumor = 'Feliz' // Define um humor padrÃ£o
      // FunÃ§Ã£o para selecionar um emoji visualmente e no input oculto
      function selectEmoji(element, value) {
        // 1. Limpa a seleÃ§Ã£o anterior
        emojiOptions.forEach((opt) => opt.classList.remove('selected-dica-emoji'))
        // 2. Aplica a seleÃ§Ã£o atual (Recomendado: defina o estilo para 'selected-dica-emoji' no seu CSS)
        if (element) {
          element.classList.add('selected-dica-emoji')
        }
        // 3. Atualiza o valor do input oculto
        estadoInput.value = value
      }
      // Adiciona listener de click para cada emoji
      emojiOptions.forEach((option) => {
        option.addEventListener('click', function () {
          const value = this.getAttribute('data-humor-value')
          selectEmoji(this, value)
        })
      })
      // 4. Inicializa com o valor padrÃ£o (para garantir que um valor seja enviado)
      const initialSelected = document.querySelector(`.dica-emoji-option[data-humor-value="${estadoInput.value || defaultHumor}"]`)
      if (initialSelected) {
        selectEmoji(initialSelected, estadoInput.value || defaultHumor)
      } else {
        // Garante que o input tenha um valor mesmo que nÃ£o haja seleÃ§Ã£o visual
        estadoInput.value = defaultHumor
      }
      // Aplica classes Bootstrap aos campos de formulÃ¡rio renderizados pelo Django
      // VocÃª DEVE garantir que esses IDs existam ou que o Django renderize a classe form-control diretamente.
      const nomeDicaInput = document.getElementById('{{ form.nome_dica.id_for_label }}')
      const descricaoTextarea = document.getElementById('{{ form.descricao.id_for_label }}')
    
      if (nomeDicaInput) {
        nomeDicaInput.classList.add('form-control')
        nomeDicaInput.classList.add('custom-dica-input') // Mantendo classe customizada
      }
      if (descricaoTextarea) {
        descricaoTextarea.classList.add('form-control')
        descricaoTextarea.classList.add('custom-dica-textarea') // Mantendo classe customizada
      }
    })
  </script>
{% endblock %}
